(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-98de"],{"23be":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.payLoading,expression:"payLoading"}],style:"mobile"===e.device?{}:{padding:"30px 120px"},attrs:{"element-loading-text":e.$t("package.payLoadingTip")}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%"},attrs:{border:"",data:e.orderData}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"table-expand",attrs:{"label-position":"left",inline:""}},[e._l(t.row.details,function(t){return[t.amount?[a("el-form-item",{key:t.order_id,attrs:{label:e.$t("order.packageName")}},[a("span",[e._v(e._s(t.subject))])]),a("el-form-item",{key:t.order_id,attrs:{label:e.$t("order.amount")}},[a("span",[e._v(e._s(t.amount))])]),a("el-form-item",{key:t.order_id,attrs:{label:e.$t("order.totalTraffic")}},[a("span",[e._v(e._s(t.traffic*t.amount)+" TB")])])]:e._e()]})],2)]}}])}),a("el-table-column",{attrs:{align:"center",prop:"created_at",label:e.$t("order.createTime")}}),a("el-table-column",{attrs:{align:"center",prop:"type",label:e.$t("order.type"),formatter:e.formatterType}}),a("el-table-column",{attrs:{align:"center",prop:"payment",label:e.$t("order.payMethod"),formatter:e.formatterPayMethod}}),a("el-table-column",{attrs:{align:"center",prop:"price",label:e.$t("order.price")}}),a("el-table-column",{attrs:{align:"center",prop:"currency",label:e.$t("order.currency")}}),a("el-table-column",{attrs:{align:"center",label:e.$t("order.status")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{size:"medium",type:"WAIT_BUYER_PAY"===t.row.trade_status?"":"TRADE_CLOSED"===t.row.trade_status?"danger":"success"}},[e._v(e._s(e.formatterStatus(t.row)))])]}}])}),a("el-table-column",{attrs:{fixed:"right",align:"center",label:e.$t("order.action")},scopedSlots:e._u([{key:"default",fn:function(t){return["WAIT_BUYER_PAY"===t.row.trade_status?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){e.handlePay(t.row)}}},[e._v(e._s(e.$t("order.pay")))]):e._e(),a("el-popover",{ref:"popover-"+t.row.order_id,style:"mobile"===e.device?"":"margin-left: 10px",attrs:{trigger:"manual",placement:"top",width:"160"}},[a("p",[e._v(e._s(e.$t("order.tip")))]),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){e.pClose(t.row.order_id)}}},[e._v(e._s(e.$t("common.cancel")))]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){e.handleCloseOrder(t.row)}}},[e._v(e._s(e.$t("common.ok")))])],1),"WAIT_BUYER_PAY"===t.row.trade_status?[a("el-button",{attrs:{slot:"reference",type:"danger",size:"mini"},on:{click:function(a){e.pShow(t.row.order_id)}},slot:"reference"},[e._v(e._s(e.$t("order.close")))])]:e._e()],2)]}}])})],1),a("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{layout:"prev, pager, next",total:e.total,"page-size":e.pageSize,"current-page":e.currentPage},on:{"current-change":e.cueerntPageChange}})],1)},n=[],o=(a("ac6a"),a("c93e")),c=(a("cadf"),a("551c"),a("097d"),a("b775"));function i(e,t,a){return Object(c["a"])({url:"order/user_id/".concat(e,"?page=").concat(t,"&page_size=").concat(a),method:"get"})}function l(e,t){return Object(c["a"])({url:"order/user_id/".concat(e,"?order_id=").concat(t),method:"delete"})}var d=a("66e6"),s=a("5f87"),u=a("2f62"),p=a("c1df"),f=a.n(p),m={name:"OrderTable",data:function(){return{tableLoading:!1,payLoading:!1,orderData:[],total:0,pageSize:10,currentPage:1}},computed:Object(o["a"])({},Object(u["b"])(["device","language"])),mounted:function(){this.handleGetOrder()},methods:{pClose:function(e){this.$refs["popover-"+e].doClose()},pShow:function(e){this.$refs["popover-"+e].doShow()},handleCloseOrder:function(e){var t=this;l(Object(s["a"])(),e.order_id).then(function(a){t.$message({message:t.$t("common.closeSuccess"),type:"success"}),t.handleGetOrder(),t.pClose(e.order_id)}).catch(function(a){t.pClose(e.order_id),console.log(a)})},formatterType:function(e){var t="";return"flow_packet_cn"===e.type||"flow_packet_en"===e.type?t=this.$t("order.flowPackage"):(this.language,t=e.details[0].subject),t},formatterPayMethod:function(e){return"alipay"===e.payment?this.$t("order.alipay"):e.payment},formatterStatus:function(e,t){var a="";switch(e.trade_status){case"WAIT_BUYER_PAY":a=this.$t("order.waitPay");break;case"TRADE_SUCCESS":a=this.$t("order.finish");break;case"TRADE_FINISHED":a=this.$t("order.finish");break;case"TRADE_CLOSED":a=this.$t("order.fail");break;default:break}return a},cueerntPageChange:function(e){this.currentPage=e,this.handleGetOrder()},formatData:function(e){return e.forEach(function(e){e.created_at=f()(e.created_at).format("YYYY-MM-DD HH:mm:ss")}),e},handleGetOrder:function(){var e=this;this.tableLoading=!0,i(Object(s["a"])(),this.currentPage,this.pageSize).then(function(t){e.tableLoading=!1,t.data&&(e.orderData=e.formatData(t.data.orders),e.total=t.data.total)}).catch(function(t){e.tableLoading=!1,e.orderData=[],e.total=0,console.log(t)})},handlePay:function(e){var t=this;this.payLoading=!0,Object(d["g"])(e.payment,e.order_id,this.device).then(function(e){e.data.available?window.location.href="".concat(e.data.pay_url):t.$messageBox.confirm(t.$t("package.systemError"),{type:"error",confirmButtonText:t.$t("common.ok"),showCancelButton:!1})}).catch(function(e){t.payLoading=!1,console.log(e)})}}},g=m,_=(a("ccdb"),a("2877")),b=Object(_["a"])(g,r,n,!1,null,"3f48e0b6",null);b.options.__file="OrderTable.vue";t["default"]=b.exports},"66e6":function(e,t,a){"use strict";a.d(t,"f",function(){return n}),a.d(t,"e",function(){return o}),a.d(t,"d",function(){return c}),a.d(t,"g",function(){return i}),a.d(t,"a",function(){return l}),a.d(t,"c",function(){return d}),a.d(t,"b",function(){return s});var r=a("b775");function n(){return Object(r["a"])({url:"goods/flow_packet",method:"get"})}function o(){return Object(r["a"])({url:"goods/monthly_packet",method:"get"})}function c(e,t){return Object(r["a"])({url:"order/user_id/".concat(e),method:"post",data:t})}function i(e,t,a){var n="mobile"===a?"&mobile=true":"";return Object(r["a"])({url:"charge/".concat(e,"/pay?order_id=").concat(t).concat(n),method:"get"})}function l(e){return Object(r["a"])({url:"charge/alipay/query?order_id=".concat(e),method:"get"})}function d(e,t,a){return Object(r["a"])({url:"charge/paypal/query?order_id=".concat(e,"&payment_id=").concat(t,"&payer_id=").concat(a),method:"get"})}function s(e,t){return Object(r["a"])({url:"user/user_id/".concat(e,"/checkin"),method:"post",data:t})}},c39d:function(e,t,a){},ccdb:function(e,t,a){"use strict";var r=a("c39d"),n=a.n(r);n.a}}]);
//# sourceMappingURL=chunk-98de.92d683d0.js.map